<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <title>Mini Games</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
        h2 { margin-top: 40px; }
        .game-box { border: 1px solid #ccc; padding: 20px; margin: 20px auto; max-width: 400px; border-radius: 10px; }
        #reactionSignal { width: 150px; height: 150px; margin: 20px auto; background-color: gray; border-radius: 50%; display: flex; justify-content: center; align-items: center; color: white; font-size: 20px; cursor: pointer; user-select: none; }
        input[type="number"] { width: 50px; }
    </style>
</head>
<body>
<h1>Mini Games</h1>
<div id="gameContainer"></div>
<button id="randomGameBtn">Arvo satunnainen peli</button>
<script>
    const games = [
        {
            name: "Reaction Game",
            description: "Klikkaa ympyrää heti, kun se muuttuu vihreäksi!",
            html: `
                <div class="game-box">
                    <h2>Reaction Game</h2>
                    <p>Klikkaa ympyrää heti, kun se muuttuu vihreäksi!</p>
                    <div id="reactionSignal">Odota...</div>
                    <p id="reactionResult"></p>
                    <button id="reactionStartBtn">Aloita peli</button>
                </div>
            `
        },
        {
            name: "Quick Math Game",
            description: "Ratkaise mahdollisimman monta yksinkertaista yhteenlaskua!",
            html: `
                <div class="game-box">
                    <h2>Quick Math Game</h2>
                    <p>Ratkaise mahdollisimman monta yksinkertaista yhteenlaskua!</p>
                    <div id="quickMathQuestion"></div>
                    <input type="number" id="quickMathAnswer" />
                    <button id="quickMathSubmit">Vastaa</button>
                    <p id="quickMathResult"></p>
                    <button id="quickMathStartBtn">Aloita peli</button>
                </div>
            `
        },
        {
            name: "Guessing Game",
            description: "Rämpytä W nappia mahdollisimman nopeasti",
            html: `
                <div class="game-box">
                    <h2>Guessing Game</h2>
                    <p>Arvaa numeroita 1–5 mahdollisimman monta kertaa!</p>
                    <input type="number" id="guessInput" min="1" max="5"/>
                    <button id="guessSubmit">Arvaa</button>
                    <p id="guessResult"></p>
                    <button id="guessStartBtn">Aloita peli</button>
                </div>
            `
        },
        {
            name: "Ryhtm Game",
            description: "Paina nuolia oikeassa järjestyksessä",
            html: `
                <div class="game-box">
                    <h2>Rythm Game</h2>
                    <p>Paina Nuolia oikeassa järjestyksessä</p>
                    <div id="tulos">Pisteet: 0</div>
                    <div id="aika">Aika: 30</div>
                    <div id="kuvat">
                        <img id="nuoliKuvat" src="./kuvat/alku.jpg" alt="alkukuva">
                    </div>
                    <div id="napit"></div>
                    <button id="start">Aloita peli</button>
                    <div class="testi"></div>
                </div>
            `
        },
        {
            name: "Rämpytys Game",
            description: "Rämpytä W nappia mahdollisimman nopeasti",
            html: `
                <div class="game-box">
                    <h2>Smashing Game</h2>
                    <p>Rämpytä W nappia mahdollisimman nopeasti</p>
                    <div id="piste2">Pisteet: 0</div>
                    <div id="aika2">Aika: 30</div>
                    <div id="kuvat">
                        <img id="kuva2" src="./kuvat/ylos.png">
                    </div>
                    <button id="start2">Aloita peli 2 (W)</button>
                    <div class="testi"></div>
                </div>
            `
        }
    ];

    function showRandomGame() {
        const gameContainer = document.getElementById('gameContainer');
        const randomIndex = Math.floor(Math.random() * games.length);
        const game = games[randomIndex];
        gameContainer.innerHTML = game.html;
        initGameLogic();
    }

    document.getElementById('randomGameBtn').addEventListener('click', showRandomGame);

    function initGameLogic() {
        const currentGameName = document.querySelector('.game-box h2').textContent;

        if (currentGameName === 'Reaction Game') {
            const reactionSignal = document.getElementById('reactionSignal');
            const reactionResult = document.getElementById('reactionResult');
            const reactionStartBtn = document.getElementById('reactionStartBtn');
            let reactionStartTime = 0;
            let reactionTimeout;
            let reactionEndTimeout;

            function startReactionGame() {
                reactionResult.textContent = "";
                reactionSignal.style.backgroundColor = 'gray';
                reactionSignal.textContent = 'Odota...';
                const duration = Math.floor(Math.random() * 6) + 15;
                const changeDelay = Math.random() * 2000 + 1000;
                reactionTimeout = setTimeout(() => {
                    reactionSignal.style.backgroundColor = 'green';
                    reactionSignal.textContent = 'Klikkaa!';
                    reactionStartTime = Date.now();
                }, changeDelay);
                reactionEndTimeout = setTimeout(() => {
                    if (reactionStartTime === 0) {
                        reactionResult.textContent = `Hävisit! Et klikannut ajoissa.`;
                    } else {
                        const reactionTime = (Date.now() - reactionStartTime) / 1000;
                        const outcome = reactionTime < 0.35 ? "Voittaja!" : "Häviäjä!";
                        reactionResult.textContent = `Reaktioaikasi: ${reactionTime.toFixed(3)} sekuntia. ${outcome}`;
                    }
                    reactionSignal.style.backgroundColor = 'gray';
                    reactionSignal.textContent = 'Odota...';
                    clearTimeout(reactionTimeout);
                }, duration * 1000);
            }

            reactionSignal.addEventListener('click', () => {
    if (reactionSignal.style.backgroundColor === 'green' && reactionStartTime > 0) {

        const reactionTime = (Date.now() - reactionStartTime) / 1000;
        const outcome = reactionTime < 0.35 ? "Voittaja!" : "Häviäjä!";
        reactionResult.textContent =
            `Reaktioaikasi: ${reactionTime.toFixed(3)} sekuntia. ${outcome}`;

        // Estetään tuplaklikit
        reactionStartTime = 0;

        // Lopetetaan pelin automaattinen häviö
        clearTimeout(reactionEndTimeout);

        // Resetoidaan signaali
        reactionSignal.style.backgroundColor = 'gray';
        reactionSignal.textContent = 'Odota...';
    }
});

            reactionStartBtn.addEventListener('click', startReactionGame);

        } else if (currentGameName === 'Quick Math Game') {
            const quickMathQuestion = document.getElementById('quickMathQuestion');
            const quickMathAnswer = document.getElementById('quickMathAnswer');
            const quickMathResult = document.getElementById('quickMathResult');
            const quickMathSubmit = document.getElementById('quickMathSubmit');
            const quickMathStartBtn = document.getElementById('quickMathStartBtn');
            let quickMathScore = 0;
            let quickMathEndTime = 0;
            let currentAnswer = 0;

            function startQuickMathGame() {
                quickMathScore = 0;
                quickMathResult.textContent = "";
                const duration = Math.floor(Math.random() * 6) + 15;
                quickMathEndTime = Date.now() + duration * 1000;
                nextQuickMathQuestion();
            }

            function nextQuickMathQuestion() {
                if (Date.now() > quickMathEndTime) {
                    const outcome = quickMathScore >= 10 ? "Voittaja!" : "Häviäjä!";
                    quickMathResult.textContent = `Pisteesi: ${quickMathScore}. ${outcome}`;
                    quickMathQuestion.textContent = "";
                    return;
                }
                const a = Math.floor(Math.random() * 10) + 1;
                const b = Math.floor(Math.random() * 10) + 1;
                currentAnswer = a + b;
                quickMathQuestion.textContent = `${a} + ${b} = ?`;
                quickMathAnswer.value = "";
                quickMathAnswer.focus();
            }

            quickMathSubmit.addEventListener('click', () => {
                if (parseInt(quickMathAnswer.value) === currentAnswer) quickMathScore++;
                nextQuickMathQuestion();
            });

            quickMathStartBtn.addEventListener('click', startQuickMathGame);

        } else if (currentGameName === 'Guessing Game') {
            const guessInput = document.getElementById('guessInput');
            const guessResult = document.getElementById('guessResult');
            const guessSubmit = document.getElementById('guessSubmit');
            const guessStartBtn = document.getElementById('guessStartBtn');
            let guessWins = 0;
            let guessAttempts = 0;
            let guessEndTime = 0;

            function startGuessingGame() {
                guessWins = 0;
                guessAttempts = 0;
                guessResult.textContent = "";
                const duration = Math.floor(Math.random() * 6) + 15;
                guessEndTime = Date.now() + duration * 1000;
            }

            guessSubmit.addEventListener('click', () => {
                if (Date.now() > guessEndTime) {
                    const outcome = guessWins >= 7 ? "Voittaja!" : "Häviäjä!";
                    guessResult.textContent = `Aikasi loppui! Voitot: ${guessWins}, yritykset: ${guessAttempts}. ${outcome}`;
                    return;
                }
                const target = Math.floor(Math.random() * 5) + 1;
                const guess = parseInt(guessInput.value);
                guessAttempts++;
                if (guess === target) guessWins++;
                guessResult.textContent = `Voitot: ${guessWins}, Yritykset: ${guessAttempts}`;
                guessInput.value = "";
                guessInput.focus();
            });

            guessStartBtn.addEventListener('click', startGuessingGame);

        } else if (currentGameName === 'Rythm Game') {
            const nuoliDiv = document.getElementById("napit");
            const pisteDiv = document.getElementById("tulos");
            const aikaDiv = document.getElementById("aika");
            const nuoliKuva = document.getElementById("nuoliKuvat");
            const startBtn = document.getElementById("start");
            let nuoli = [];
            let pisteet = 0;
            let aika = 30;
            let active = false;
            let timer;
            const voitto = 30;
            const nuolet = ["←", "↑", "↓", "→"];
            const nuoliKuvat = {
                "←": "./kuvat/vasen.jpg",
                "↑": "./kuvat/ylos.png",
                "↓": "./kuvat/alas.jpg",
                "→": "./kuvat/oikea.jpg"
            };

            function startGame() {
                pisteet = 0;
                aika = 30;
                active = true;
                luoNuoli();
                taulu();
                nuoliKuva.src = "./kuvat/alku.jpg";
                if (timer) clearInterval(timer);
                timer = setInterval(ajastin, 1000);
            }

            function luoNuoli() {
                nuoli = [];
                for (let i = 0; i < 5; i++) {
                    nuoli.push(randNuoli());
                }
                taulu();
            }

            function randNuoli() {
                return nuolet[Math.floor(Math.random() * nuolet.length)];
            }

            function taulu() {
                nuoliDiv.textContent = nuoli.join(" ");
                pisteDiv.textContent = "Pisteet: " + pisteet;
                aikaDiv.textContent = "Aika: " + aika;
            }

            function voittoTarkistus() {
                if (pisteet >= voitto) {
                    active = false;
                    clearInterval(timer);
                    const gameContainer = document.getElementById('gameContainer');
                    gameContainer.innerHTML = `
                        <div class="game-box">
                            <img src="./kuvat/lesgo.jpg" alt="raaah">
                            <p>Voitit!</p>
                            <button id="backToMenu">Jatka</button>
                        </div>
                    `;
                    document.getElementById('backToMenu').addEventListener('click', () => {
                        gameContainer.innerHTML = '';
                    });
                }
            }

            function lopeta() {
                active = false;
                clearInterval(timer);
                const gameContainer = document.getElementById('gameContainer');
                gameContainer.innerHTML = `
                    <div class="game-box">
                        <img src="./kuvat/lesgo.jpg" alt="raaah">
                        <p>Nyt loppu lmao</p>
                        <button id="backToMenu">Jatka</button>
                    </div>
                `;
                document.getElementById('backToMenu').addEventListener('click', () => {
                    gameContainer.innerHTML = '';
                });
            }

            function ajastin() {
                if (!active) return;
                aika--;
                taulu();
                voittoTarkistus();
                if (aika <= 0) {
                    lopeta();
                }
            }

            function luoNuoliKuva(nappi) {
                nuoliKuva.src = nuoliKuvat[nappi];
            }

            startBtn.addEventListener("click", startGame);

            document.addEventListener("keydown", (e) => {
                if (!active) return;
                const eka = nuoli[0];
                let näppäin = "";
                if (e.key === "ArrowLeft") näppäin = "←";
                if (e.key === "ArrowUp") näppäin = "↑";
                if (e.key === "ArrowDown") näppäin = "↓";
                if (e.key === "ArrowRight") näppäin = "→";
                if (!näppäin) return;
                if (näppäin === eka) {
                    nuoli.shift();
                    pisteet++;
                    nuoli.push(randNuoli());
                    taulu();
                    luoNuoliKuva(näppäin);
                    voittoTarkistus();
                } else {
                    lopeta();
                }
            });

        } else if (currentGameName === 'Smashing Game') {
            const piste2Div = document.getElementById("piste2");
            const aika2Div = document.getElementById("aika2");
            const kuva2 = document.getElementById("kuva2");
            const startBtn = document.getElementById("start2");
            let piste2 = 0;
            let aika2 = 30;
            let active2 = false;
            let timer2 = null;
            let drop = null;
            const kuvatTasot = [
                "./kuvat/alas.jpg",
                "./kuvat/oikea.jpg",
                "./kuvat/vasen.jpg",
                "./kuvat/alas.jpg",
            ];

            function startGame2() {
                piste2 = 0;
                aika2 = 30;
                active2 = true;
                updateGame2();
                if (timer2) clearInterval(timer2);
                if (drop) clearInterval(drop);
                timer2 = setInterval(aikaTick2, 1000);
                drop = setInterval(pisteReduce, 200);
            }

            function updateGame2() {
                piste2Div.textContent = "Pisteet: " + piste2;
                aika2Div.textContent = "Aika: " + aika2;
                if (piste2 < 5) kuva2.src = kuvatTasot[0];
                else if (piste2 < 10) kuva2.src = kuvatTasot[1];
                else if (piste2 < 20) kuva2.src = kuvatTasot[2];
                else if (piste2 === 25) kuva2.src = kuvatTasot[3];
            }

            function pisteReduce() {
                if (!active2) return;
                if (piste2 > 0) {
                    piste2--;
                    updateGame2();
                }
            }

            function aikaTick2() {
                if (!active2) return;
                aika2--;
                updateGame2();
                if (aika2 <= 0) {
                    end2();
                }
            }

            function win2() {
                active2 = false;
                clearInterval(timer2);
                clearInterval(drop);
                const gameContainer = document.getElementById('gameContainer');
                gameContainer.innerHTML = `
                    <div class="game-box">
                        <img src="./kuvat/lesgo.jpg" alt="raaah">
                        <p>Voitit pelin!</p>
                        <button id="backToMenu">Jatka</button>
                    </div>
                `;
                document.getElementById('backToMenu').addEventListener('click', () => {
                    gameContainer.innerHTML = '';
                });
            }

            function end2() {
                active2 = false;
                clearInterval(timer2);
                clearInterval(drop);
                const gameContainer = document.getElementById('gameContainer');
                gameContainer.innerHTML = `
                    <div class="game-box">
                        <img src="./kuvat/lesgo.jpg" alt="raaah">
                        <p>Hävisit pelin!</p>
                        <button id="backToMenu">Jatka</button>
                    </div>
                `;
                document.getElementById('backToMenu').addEventListener('click', () => {
                    gameContainer.innerHTML = '';
                });
            }

            startBtn.addEventListener('click', startGame2);

            document.addEventListener("keydown", (e) => {
                if (!active2) return;
                if (e.key === "w" || e.key === "W") {
                    piste2++;
                    updateGame2();
                    if (piste2 >= 25) win2();
                }
            });
        }
    }
</script>
</body>
</html>
